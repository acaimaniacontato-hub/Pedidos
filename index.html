<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ßa√≠ Mania - Pedido Online</title>
    <style>
        :root { --roxo: #5a1770; --roxo-claro: #f4e9f7; --roxo-hover: #46105a; --verde-whats: #25d366; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--roxo-claro); margin: 0; padding: 0; }
        header { background: var(--roxo); color: #fff; padding: 30px 20px; text-align: center; }
        .logo-img { width: 120px; height: 120px; border-radius: 20px; border: 3px solid #fff; margin-bottom: 10px; }
        .container { max-width: 600px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: var(--roxo); border-bottom: 2px solid var(--roxo-claro); padding-bottom: 8px; margin-top: 25px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        
        .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .checkbox-group label { display: flex; align-items: center; font-weight: normal; background: #f9f9f9; padding: 8px; border-radius: 6px; border: 1px solid #eee; cursor: pointer; }
        .checkbox-group input { width: auto; margin-right: 10px; }
        
        button { margin-top: 20px; width: 100%; padding: 16px; background: var(--roxo); color: #fff; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: var(--roxo-hover); }
        .btn-acao { padding: 8px; font-size: 14px; width: auto; margin-top: 0; font-weight: normal; border-radius: 5px; margin-left: 5px; }
        .btn-editar { background: #ffcc00; color: #000; }
        .btn-remover { background: #ff4444; color: #fff; }

        .resumo { background: #fff; border: 2px solid var(--roxo); padding: 20px; border-radius: 10px; margin-top: 25px; display: none; }
        .item-carrinho { background: #fdfbff; padding: 10px; border-radius: 5px; margin-bottom: 8px; border-left: 4px solid var(--roxo); display: flex; justify-content: space-between; align-items: center; }
        .total-destaque { font-size: 20px; font-weight: bold; color: #2d0a35; text-align: center; background: var(--roxo-claro); padding: 10px; border-radius: 8px; }

        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; color: white; text-align: center; flex-direction: column; }
    </style>
</head>
<body>

<div id="overlay" class="overlay">
    <h2 style="color: var(--verde-whats);">‚úî Pedido Registrado!</h2>
    <p>Abrindo o WhatsApp da loja...</p>
    <div style="margin-top: 20px; font-size: 50px;">üíú</div>
</div>

<header>
    <img src="acai.jpeg" alt="Logo A√ßa√≠ Mania" class="logo-img">
    <h1>A√ßa√≠ Mania üíú</h1>
</header>

<div class="container">
    <h2>1. Seus Dados</h2>
    <input type="text" id="nome" placeholder="Nome Completo" oninput="atualizarResumo()">
    <input type="tel" id="telefone" placeholder="WhatsApp (61) 99999-9999" oninput="atualizarResumo()">
    <select id="cidade" onchange="atualizarResumo()">
        <option value="Itapo√° Parque">Itapo√° Parque (Frete GR√ÅTIS)</option>
        <option value="Parano√°">Parano√° (Frete R$ 7,00)</option>
        <option value="Parano√° Parque">Parano√° Parque (Frete R$ 7,00)</option>
        <option value="Cond. Entre lagos">Cond. Entre lagos (Frete R$ 7,00)</option>
        <option value="Capoeira do balsamo">Capoeira do balsamo (Frete R$ 7,00)</option>
    </select>
    <input type="text" id="endereco" placeholder="Rua, Conjunto e Casa" oninput="atualizarResumo()">

    <h2>2. Escolha seu Produto</h2>
    <select id="produto" onchange="atualizarTamanhos()">
        <option value="A√ßa√≠">A√ßa√≠ Puro</option>
        <option value="A√ßa√≠ com Nutella">A√ßa√≠ com Nutella</option>
        <option value="Cupua√ßu">Cupua√ßu Puro</option>
        <option value="Casadinho">Casadinho (A√ßa√≠ + Cupua√ßu)</option>
        <option value="Combo Casal" data-fixo="36.00">Combo Casal ‚Äì 2 copos 400 ml ‚Äî R$ 36,00</option>
        <option value="Combo Fam√≠lia" data-fixo="51.00">Combo Fam√≠lia ‚Äì 3 copos 400 ml ‚Äî R$ 51,00</option>
        <option value="Combo Mania" data-fixo="26.00">Combo Mania ‚Äì 500 ml casadinho + Nutella ‚Äî R$ 26,00</option>
    </select>

    <div id="boxTamanho">
        <label>Tamanho</label>
        <select id="tamanho"></select>
    </div>

    <label>Acompanhamentos (Gr√°tis)</label>
    <div class="checkbox-group">
        <label><input type="checkbox" class="adc" value="Granola"> Granola</label>
        <label><input type="checkbox" class="adc" value="Pa√ßoca"> Pa√ßoca</label>
        <label><input type="checkbox" class="adc" value="Amendoim"> Amendoim</label>
        <label><input type="checkbox" class="adc" value="Leite em P√≥"> Leite em P√≥</label>
        <label><input type="checkbox" class="adc" value="Leite Condensado"> Leite Condensado</label>
        <label><input type="checkbox" class="adc" value="Banana"> Banana</label>
        <label><input type="checkbox" class="adc" value="Morango"> Morango</label>
    </div>

    <button onclick="adicionarItem()">+ Adicionar ao Carrinho</button>

    <div id="resumo" class="resumo">
        <h3>üìã Resumo do Pedido</h3>
        <div id="resumoDados"></div>
        <div id="listaItens" style="margin-top: 15px;"></div>
        <div id="resumoFinanceiro" class="total-destaque" style="margin-top: 15px;"></div>
        <button id="btnFinalizar" style="background: var(--verde-whats);" onclick="finalizarPedido()">Finalizar no WhatsApp üì±</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz6VymyYf0K4EUZgE-88hrOHRfJx-EI-_VOW2jUf3RD-F71z2BG_AyxpWB1CN5EYcg/exec"; 
    let carrinho = [];

    function atualizarTamanhos() {
        const p = document.getElementById("produto").value;
        const t = document.getElementById("tamanho");
        const box = document.getElementById("boxTamanho");
        if (p.includes("Combo")) { box.style.display = "none"; return; }
        box.style.display = "block";
        let options = "";
        if (p === "A√ßa√≠") options = `<option value="12">300 ml ‚Äî R$ 12,00</option><option value="15">400 ml ‚Äî R$ 15,00</option><option value="18">500 ml ‚Äî R$ 18,00</option>`;
        else if (p === "A√ßa√≠ com Nutella" || p === "Casadinho") options = `<option value="14">300 ml ‚Äî R$ 14,00</option><option value="18">400 ml ‚Äî R$ 18,00</option><option value="22">500 ml ‚Äî R$ 22,00</option>`;
        else if (p === "Cupua√ßu") options = `<option value="13">300 ml ‚Äî R$ 13,00</option><option value="16">400 ml ‚Äî R$ 16,00</option><option value="19">500 ml ‚Äî R$ 19,00</option>`;
        t.innerHTML = options;
    }
    atualizarTamanhos();

    function adicionarItem() {
        const selP = document.getElementById("produto");
        const prodNome = selP.options[selP.selectedIndex].text.split("‚Äî")[0].trim();
        const prodVal = selP.value;
        let v = 0, tamTxt = "";

        if (prodVal.includes("Combo")) {
            v = parseFloat(selP.options[selP.selectedIndex].getAttribute("data-fixo"));
            tamTxt = "Combo";
        } else {
            const selT = document.getElementById("tamanho");
            v = parseFloat(selT.value);
            tamTxt = selT.options[selT.selectedIndex].text.split("‚Äî")[0].trim();
        }

        let adcs = [];
        document.querySelectorAll('.adc:checked').forEach(el => adcs.push(el.value));
        carrinho.push({ p: prodNome, t: tamTxt, a: adcs, v: v, pOrig: prodVal });
        document.querySelectorAll('.adc').forEach(el => el.checked = false);
        atualizarResumo();
    }

    function removerItem(index) {
        carrinho.splice(index, 1);
        atualizarResumo();
    }

    function atualizarResumo() {
        const resumoDiv = document.getElementById("resumo");
        if (carrinho.length === 0) { resumoDiv.style.display = "none"; return; }
        resumoDiv.style.display = "block";

        const nome = document.getElementById("nome").value || "...";
        const tel = document.getElementById("telefone").value || "...";
        const cid = document.getElementById("cidade").value;
        const end = document.getElementById("endereco").value || "...";
        
        document.getElementById("resumoDados").innerHTML = `<b>Cliente:</b> ${nome}<br><b>WhatsApp:</b> ${tel}<br><b>Entrega:</b> ${cid} - ${end}`;

        const lista = document.getElementById("listaItens");
        lista.innerHTML = "";
        let subtotal = 0;
        carrinho.forEach((i, idx) => {
            subtotal += i.v;
            lista.innerHTML += `
                <div class="item-carrinho">
                    <div><strong>${i.p} (${i.t})</strong><br><small>${i.a.join(", ") || "Sem adcs"}</small></div>
                    <button class="btn-acao btn-remover" onclick="removerItem(${idx})">üóëÔ∏è</button>
                </div>`;
        });

        const frete = cid === "Itapo√° Parque" ? 0 : 7;
        const total = subtotal + frete;
        document.getElementById("resumoFinanceiro").innerHTML = `Subtotal: R$ ${subtotal.toFixed(2)} | Frete: R$ ${frete.toFixed(2)}<br><strong>TOTAL: R$ ${total.toFixed(2)}</strong>`;
    }

    function finalizarPedido() {
        const nome = document.getElementById("nome").value;
        const tel = document.getElementById("telefone").value;
        const cid = document.getElementById("cidade").value;
        const end = document.getElementById("endereco").value;
        
        if(!nome || !tel || !end) return alert("Por favor, preencha seus dados de entrega!");

        const resumoFin = document.getElementById("resumoFinanceiro").innerText;
        const totalTxt = resumoFin.split("TOTAL:")[1].trim();
        const id = "MANIA-" + Math.floor(1000 + Math.random() * 9000);

        // 1. Mensagem Formatada
        let msg = `*NOVO PEDIDO ${id}* üíú\n\n*Cliente:* ${nome}\n*WhatsApp:* ${tel}\n*Endere√ßo:* ${cid}, ${end}\n\n*ITENS:*`;
        carrinho.forEach(i => msg += `\n- ${i.p} (${i.t}) [${i.a.join(", ") || "Sem adcs"}]`);
        msg += `\n\n*TOTAL: ${totalTxt}*`;

        // 2. Envio silencioso para planilha (Navigator Beacon √© melhor para mobile)
        const payload = JSON.stringify({ id, nome, telefone: tel, cidade: cid, endereco: end, carrinho, total: totalTxt });
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: payload });

        // 3. Feedback e Redirecionamento
        document.getElementById("overlay").style.display = "flex";

        setTimeout(() => {
            // No celular, window.location.href funciona melhor que window.open
            window.location.href = `https://api.whatsapp.com/send?phone=5561995214424&text=${encodeURIComponent(msg)}`;
        }, 1000);
    }
</script>
</body>
</html>
