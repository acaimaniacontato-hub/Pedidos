<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ßa√≠ Mania - Premium Delivery</title>
    <style>
        :root { 
            --bg-dark: #1a0521; 
            --card-bg: #2d0b37;
            --roxo-vibrante: #9d34da;
            --texto: #f4e9f7;
            --verde-whats: #25d366; 
            --dourado: #ffcf4b; 
            --fundo-input: #ffffff;
            --alerta: #ff4444;
            --desativado: #555555;
        }
        
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-dark); color: var(--texto); margin: 0; padding-bottom: 80px; }
        header { background: linear-gradient(180deg, #3e0e4d 0%, var(--bg-dark) 100%); padding: 30px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo-img { width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--roxo-vibrante); margin-bottom: 10px; object-fit: cover; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .card-secao { background: var(--card-bg); padding: 20px; border-radius: 18px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        h2 { color: var(--dourado); font-size: 1.2rem; margin-top: 0; }
        
        input, select, textarea { width: 100%; padding: 15px; margin-top: 8px; border: 2px solid var(--roxo-vibrante); border-radius: 12px; font-size: 16px; box-sizing: border-box; background: var(--fundo-input); color: #000; font-weight: 600; }
        textarea { height: 90px; resize: none; font-family: inherit; }

        .desc-produto { background: #fff3cd; border-left: 5px solid #ffc107; padding: 12px; margin: 15px 0; font-size: 0.9rem; color: #856404; font-weight: bold; border-radius: 8px; display: none; }
        
        .bloco-acai { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid var(--roxo-vibrante); margin-bottom: 15px; }
        .titulo-acai { color: var(--dourado); font-weight: bold; margin-bottom: 10px; display: block; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .tag-aviso { color: var(--alerta); font-size: 0.8rem; font-weight: 800; display: block; margin-bottom: 5px; }

        .grid-complementos { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .secao-frutas { grid-column: 1 / -1; color: var(--dourado); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px; margin-top: 10px; }
        .item-check { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: white; cursor: pointer; }
        .item-check input { width: 20px; height: 20px; }
        
        .btn-principal { background: var(--roxo-vibrante); color: white; border: none; padding: 18px; border-radius: 12px; width: 100%; font-size: 18px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 15px; }
        
        .btn-concluir { 
            background: var(--verde-whats); color: white; border: none; padding: 20px; border-radius: 12px; width: 100%; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 15px;
            box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            animation: pulse-green 2s infinite;
        }

        /* Estilo para bot√µes desativados */
        .btn-disabled {
            background-color: var(--desativado) !important;
            cursor: not-allowed !important;
            animation: none !important;
            box-shadow: none !important;
            opacity: 0.6;
        }

        @keyframes pulse-green {
            0% { transform: scale(0.98); box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.4); }
            70% { transform: scale(1); box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
            100% { transform: scale(0.98); box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
        }
        
        .resumo { background: white; border: 4px solid var(--roxo-vibrante); padding: 20px; border-radius: 15px; margin-top: 25px; color: black; display: none; }
        .item-carrinho { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding: 12px 0; }
        .btn-remover { background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .info-frete { color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); margin: 20% auto; padding: 25px; border: 2px solid var(--roxo-vibrante); width: 85%; max-width: 400px; border-radius: 20px; text-align: center; }
        .modal-btns { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn-modal-add { background: transparent; color: var(--dourado); border: 2px solid var(--dourado); padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-modal-final { background: var(--verde-whats); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        .btn-flutuante {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 20px;
            right: 20px;
            background-color: var(--verde-whats);
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }
    </style>
</head>
<body onload="verificarHorario()">

<a href="https://wa.me/5561995214424?text=Ol√°! Gostaria de tirar uma d√∫vida sobre meu pedido." class="btn-flutuante" target="_blank">
    <span style="font-size: 35px;">üí¨</span>
</a>

<div id="modalDecisao" class="modal">
    <div class="modal-content">
        <h2 style="color: white;">‚úÖ Item Adicionado!</h2>
        <p style="color: var(--texto);">O que deseja fazer agora?</p>
        <div class="modal-btns">
            <button class="btn-modal-add" onclick="fecharModal()">+ CONTINUAR COMPRANDO</button>
            <button class="btn-modal-final" onclick="irParaResumo()">üõí FINALIZAR PEDIDO</button>
        </div>
    </div>
</div>

<header>
    <img src="acai.jpeg" alt="Logo" class="logo-img">
    <h1>A√ßa√≠ Mania üíú</h1>
</header>

<div class="container">
    <div id="statusLoja" style="text-align:center; padding:10px; border-radius:10px; margin-bottom:15px; font-weight:bold; color: white;">Verificando...</div>

    <div class="card-secao">
        <h2>üìç Entrega</h2>
        <input type="text" id="nome" placeholder="Seu Nome">
        <input type="tel" id="whatsapp_cliente" placeholder="Seu WhatsApp (61) 9...." maxlength="15" onkeyup="handlePhone(event)">
        
        <select id="cidade" onchange="atualizarResumo()">
            <option value="Itapo√° Parque">Itapo√° Parque (Gr√°tis)</option>
            <option value="Itapo√° I">Itapo√° I (R$ 5,00)</option>
            <option value="Itapo√° II">Itapo√° II (R$ 5,00)</option>
            <option value="Itapo√° - Del Lago">Itapo√° - Del Lago (R$ 5,00)</option>
            <option value="Parano√°">Parano√° (R$ 7,00)</option>
            <option value="Parano√° Parque">Parano√° Parque (R$ 7,00)</option>
            <option value="Cond. Entre Lagos">Cond. Entre Lagos (R$ 8,00)</option>
            <option value="Cond. Novo Horizonte">Cond. Novo Horizonte (R$ 8,00)</option>
            <option value="Cond. La Font">Cond. La Font (R$ 8,00)</option>
        </select>
        <input type="text" id="endereco" placeholder="Endere√ßo Completo">
        <textarea id="observacao" placeholder="Alguma observa√ß√£o? (Ex: Retirar amendoim, troco para R$ 50, campainha estragada...)"></textarea>
    </div>

    <div class="card-secao" id="secaoProdutos">
        <h2>ü•§ Produto</h2>
        <select id="produto" onchange="atualizarOpcoes()">
            <option value="">Escolha aqui...</option>
            <optgroup label="A√ßa√≠s e Cupua√ßu">
                <option value="A√ßa√≠ Tradicional" data-desc="üíú A√ßa√≠ cremoso batido na hora!" data-qtd="1">A√ßa√≠ Tradicional (Sem Nutella)</option>
                <option value="A√ßa√≠ com Nutella" data-desc="üç´ A√ßa√≠ premium com Nutella aut√™ntica." data-qtd="1">A√ßa√≠ com Nutella</option>
                <option value="Cupua√ßu" data-desc="‚ö™ Polpa de cupua√ßu pura e cremosa." data-qtd="1">Cupua√ßu Puro</option>
            </optgroup>
            <optgroup label="Combos Especiais">
                <option value="Combo Casal" data-fixo="36.00" data-desc="üëâ 2 A√ßa√≠s de 400 ml com Nutella." data-qtd="2">Combo Casal ‚Äî R$ 36,00</option>
                <option value="Combo Fam√≠lia" data-fixo="54.00" data-desc="üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Combo Fam√≠lia: 3 A√ßa√≠s de 400 ml com Nutella." data-qtd="3">Combo Fam√≠lia ‚Äî R$ 54,00</option>
                <option value="Combo Fam√≠lia Mix" data-fixo="51.00" data-desc="üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Combo Fam√≠lia Mix: 2 A√ßa√≠s de 400 ml com Nutella + 1 A√ßa√≠ de 400 ml sem Nutella." data-qtd="3">Combo Fam√≠lia Mix ‚Äî R$ 51,00</option>
                <option value="Combo Mania" data-fixo="28.00" data-desc="üçìüç´ 500 ml Casadinho com Nutella." data-qtd="1">Combo Mania ‚Äî R$ 28,00</option>
            </optgroup>
        </select>

        <div id="descProduto" class="desc-produto"></div>

        <div id="boxEscolhas" style="display:none;">
            <div id="boxTamanho">
                <label style="color:var(--dourado); font-weight:bold; display:block; margin-top:10px;">Tamanho:</label>
                <select id="tamanho" onchange="atualizarResumo()"></select>
            </div>
            <div id="containerAcais"></div>
        </div>
        <button id="btnAdicionar" class="btn-principal" onclick="adicionarItem()">+ ADICIONAR AO PEDIDO</button>
    </div>

    <div class="card-secao">
        <h2>üí≥ Pagamento</h2>
        <select id="pagamento">
            <option value="Pix">Pix (Chave: 61995214424)</option>
            <option value="Cart√£o">Cart√£o na Entrega</option>
            <option value="Dinheiro">Dinheiro</option>
        </select>
    </div>

    <div id="resumo" class="resumo">
        <h3 style="margin-top:0;">üõí Seu Pedido</h3>
        <div id="listaItens"></div>
        <div id="detalheFinanceiro" style="margin-top:15px; border-top: 1px solid #eee; padding-top:10px; text-align:right;">
            <span class="info-frete" id="txtFrete">Frete: R$ 0,00</span>
        </div>
        <div id="total" style="font-size:1.5rem; font-weight:800; text-align:center; margin:10px 0;"></div>
        <button id="btnFinalizar" class="btn-concluir" onclick="finalizarPedido()">CONCLUIR PEDIDO</button>
    </div>
</div>

<script>
    let carrinho = [];
    let valorTotalFinal = 0;
    let lojaAberta = true; // Vari√°vel de controle

    function fecharModal() {
        document.getElementById("modalDecisao").style.display = "none";
        document.getElementById("produto").value = "";
        document.getElementById("boxEscolhas").style.display = "none";
        document.getElementById("descProduto").style.display = "none";
    }

    function irParaResumo() {
        document.getElementById("modalDecisao").style.display = "none";
        document.getElementById("resumo").scrollIntoView({ behavior: 'smooth' });
    }

    function handlePhone(event) {
        let input = event.target;
        input.value = phoneMask(input.value);
    }

    function phoneMask(value) {
        if (!value) return "";
        value = value.replace(/\D/g, "");
        value = value.replace(/(\d{2})(\d)/, "($1) $2");
        value = value.replace(/(\d{5})(\d)/, "$1-$2");
        return value;
    }

    function limitarFruta(checkbox, grupo) {
        document.querySelectorAll(`.fruta-check-${grupo}`).forEach(c => { if(c !== checkbox) c.checked = false; });
    }

    function verificarHorario() {
        const hora = new Date().getHours();
        const s = document.getElementById("statusLoja");
        const btnAdd = document.getElementById("btnAdicionar");
        const btnFin = document.getElementById("btnFinalizar");

        // Hor√°rio: das 10:00 at√© as 22:00
        if(hora >= 10 && hora < 22) { 
            s.innerHTML = "üü¢ ABERTO"; 
            s.style.background = "#25d366"; 
            lojaAberta = true;
            btnAdd.classList.remove("btn-disabled");
            btnFin.classList.remove("btn-disabled");
            btnAdd.innerText = "+ ADICIONAR AO PEDIDO";
        } else { 
            s.innerHTML = "üî¥ FECHADO NO MOMENTO"; 
            s.style.background = "#ff4444"; 
            lojaAberta = false;
            btnAdd.classList.add("btn-disabled");
            btnFin.classList.add("btn-disabled");
            btnAdd.innerText = "LOJA FECHADA";
            btnFin.innerText = "LOJA FECHADA";
        }
    }

    function criarBlocoAcai(numero, infoExtra = "") {
        return `
            <div class="bloco-acai">
                ${infoExtra ? `<span class="tag-aviso">${infoExtra}</span>` : ''}
                <span class="titulo-acai">A√ßa√≠ 0${numero} - Escolha os Complementos:</span>
                <div class="grid-complementos">
                    <div class="secao-frutas">üçé Fruta (Escolha uma):</div>
                    <label class="item-check"><input type="checkbox" class="fruta-check-${numero}" value="Banana" onclick="limitarFruta(this, ${numero})"> üçå Banana</label>
                    <label class="item-check"><input type="checkbox" class="fruta-check-${numero}" value="Morango" onclick="limitarFruta(this, ${numero})"> üçì Morango</label>
                    <div class="secao-frutas">‚ú® Outros:</div>
                    <label class="item-check"><input type="checkbox" class="comp-${numero}" value="Leite em P√≥"> Leite em P√≥</label>
                    <label class="item-check"><input type="checkbox" class="comp-${numero}" value="Granola"> Granola</label>
                    <label class="item-check"><input type="checkbox" class="comp-${numero}" value="Pa√ßoca"> Pa√ßoca</label>
                    <label class="item-check"><input type="checkbox" class="comp-${numero}" value="Amendoin"> Amendoin</label>
                    <label class="item-check"><input type="checkbox" class="comp-${numero}" value="Leite Condensado"> Leite Condensado</label>
                </div>
            </div>`;
    }

    function atualizarOpcoes() {
        const pSel = document.getElementById("produto");
        const pValue = pSel.value;
        const box = document.getElementById("boxEscolhas");
        const container = document.getElementById("containerAcais");
        const descDiv = document.getElementById("descProduto");
        if(!pValue) { box.style.display = "none"; descDiv.style.display = "none"; return; }
        descDiv.innerHTML = pSel.options[pSel.selectedIndex].getAttribute("data-desc");
        descDiv.style.display = "block";
        box.style.display = "block";
        const qtd = parseInt(pSel.options[pSel.selectedIndex].getAttribute("data-qtd"));
        container.innerHTML = "";
        for(let i=1; i<=qtd; i++) {
            let aviso = (pValue === "Combo Fam√≠lia Mix" && i === 3) ? "‚ö†Ô∏è ESTE A√áA√ç √â O SEM NUTELLA" : "";
            container.innerHTML += criarBlocoAcai(i, aviso);
        }
        const boxT = document.getElementById("boxTamanho");
        const tSel = document.getElementById("tamanho");
        if(pValue.includes("Combo")) {
            boxT.style.display = "none";
        } else {
            boxT.style.display = "block";
            if(pValue === "A√ßa√≠ Tradicional") {
                tSel.innerHTML = '<option value="12">300ml - R$ 12</option><option value="16">400ml - R$ 16</option><option value="20">500ml - R$ 20</option>';
            } else if(pValue === "A√ßa√≠ com Nutella") {
                tSel.innerHTML = '<option value="15">300ml - R$ 15</option><option value="19">400ml - R$ 19</option><option value="23">500ml - R$ 23</option>';
            } else {
                tSel.innerHTML = '<option value="15">300ml - R$ 15</option><option value="16">400ml - R$ 16</option><option value="20">500ml - R$ 20</option>';
            }
        }
    }

    function adicionarItem() {
        if(!lojaAberta) return alert("Desculpe, a loja est√° fechada no momento!");
        
        const pSel = document.getElementById("produto");
        const pValue = pSel.value;
        if(!pValue) return alert("Escolha um produto!");
        const qtd = parseInt(pSel.options[pSel.selectedIndex].getAttribute("data-qtd"));
        let todosComplementos = [];
        for(let i=1; i<=qtd; i++) {
            let compsPote = [];
            document.querySelectorAll(`.fruta-check-${i}:checked`).forEach(c => compsPote.push(c.value));
            document.querySelectorAll(`.comp-${i}:checked`).forEach(c => compsPote.push(c.value));
            let labelA√ßai = `A√ßa√≠ 0${i}`;
            if(pValue === "Combo Fam√≠lia Mix" && i === 3) labelA√ßai = "A√ßa√≠ 03 (Sem Nutella)";
            todosComplementos.push(`${labelA√ßai}: [${compsPote.join(", ") || "Nenhum"}]`);
        }
        const nomeP = pSel.options[pSel.selectedIndex].text.split('‚Äî')[0];
        let valor = pValue.includes("Combo") ? parseFloat(pSel.options[pSel.selectedIndex].getAttribute("data-fixo")) : parseFloat(document.getElementById("tamanho").value);
        carrinho.push({
            nome: nomeP.trim(),
            tamanho: pValue.includes("Combo") ? "" : document.getElementById("tamanho").options[document.getElementById("tamanho").selectedIndex].text.split('-')[0].trim(),
            valor: valor,
            comp: todosComplementos.join(" | ")
        });
        document.getElementById("modalDecisao").style.display = "block";
        atualizarResumo();
    }

    function atualizarResumo() {
        const res = document.getElementById("resumo");
        if(carrinho.length === 0) { res.style.display = "none"; return; }
        res.style.display = "block";
        let html = "";
        let subtotal = 0;
        carrinho.forEach((i, idx) => {
            subtotal += i.valor;
            html += `<div class="item-carrinho">
                <span><b>${i.nome} ${i.tamanho}</b><br><small>${i.comp}</small></span>
                <button class="btn-remover" onclick="carrinho.splice(${idx},1); atualizarResumo();">Remover</button>
            </div>`;
        });
        const cid = document.getElementById("cidade").value;
        let frete = (cid === "Itapo√° - Del Lago" || cid === "Parano√°" || cid === "Parano√° Parque") ? 7 : (cid.includes("Cond.") ? 8 : 0);
        document.getElementById("txtFrete").innerHTML = frete > 0 ? `Frete: R$ ${frete.toFixed(2)}` : `Frete: GR√ÅTIS`;
        valorTotalFinal = subtotal + frete;
        document.getElementById("listaItens").innerHTML = html;
        document.getElementById("total").innerHTML = `TOTAL: R$ ${valorTotalFinal.toFixed(2)}`;
    }

    function finalizarPedido() {
        if(!lojaAberta) return alert("Loja Fechada! N√£o √© poss√≠vel processar o pedido.");
        
        const nome = document.getElementById("nome").value;
        const zap_cliente = document.getElementById("whatsapp_cliente").value;
        const cid = document.getElementById("cidade").value;
        const end = document.getElementById("endereco").value;
        const pag = document.getElementById("pagamento").value;
        const obs = document.getElementById("observacao").value;
        
        if(!nome || !end || !zap_cliente) return alert("Preencha Nome, WhatsApp e Endere√ßo!");

        const pedidoId = "AM-" + Date.now().toString().slice(-6);
        
        let itensParaPlanilha = carrinho.map(i => ({
            produto: i.nome + " " + i.tamanho,
            complementos: i.comp
        }));

        let msg = `*PEDIDO #${pedidoId}* üíú\n\n*Cliente:* ${nome}\n*WhatsApp:* ${zap_cliente}\n*Cidade:* ${cid}\n*Endere√ßo:* ${end}\n`;
        
        if(obs) { msg += `*Obs:* ${obs}\n`; }
        
        msg += `\n*ITENS:*`;
        carrinho.forEach(i => { msg += `\n- ${i.nome} ${i.tamanho}\n  ${i.comp}\n`; });
        msg += `\n*TOTAL: R$ ${valorTotalFinal.toFixed(2)}*\n*Pagamento:* ${pag}`;

        fetch('https://script.google.com/macros/s/AKfycbzYPdG111gJeR5v26HLgt-7qk2kBInHbMGUyj4iefYER3y_6Z9mYEuPwnIK7VxT9YIZEQ/exec', {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({
                id: pedidoId,
                nome: nome,
                whatsapp: zap_cliente,
                cidade: cid,
                endereco: end,
                observacao: obs,
                itens: itensParaPlanilha,
                valorTotal: valorTotalFinal.toFixed(2),
                pagamento: pag
            })
        });

        window.location.href = `https://wa.me/5561995214424?text=${encodeURIComponent(msg)}`;
    }
</script>
</body>
</html>
